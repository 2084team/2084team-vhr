# 2084team OAç³»ç»Ÿçš„éƒ¨ç½²

è¿™é‡Œä¸»è¦è®²æ€ä¹ˆéƒ¨ç½²é¡¹ç›®ï¼Œåˆ†å¸ƒå¼éƒ¨ç½²ï¼Œå…·ä½“ç»†èŠ‚å…¨åœ¨æˆ‘ä»¬å›¢é˜Ÿçš„ä»“åº“ä»£ç ä¸­

[åŸé¡¹ç›®åœ°å€](https://github.com/lenve/vhr)

[å›¢é˜Ÿgitä»“åº“]()

ç•Œé¢ç²¾ç¾ï¼Œä»£ç ä¼˜ç¾ï¼Œç³»ç»Ÿå¹¶ä¸å¤æ‚ï¼Œé€‚åˆåˆå­¦è€…

å¯ä»¥å‰åç«¯åˆ†ç¦»ï¼Œä¹Ÿå¯ä»¥ä¸åˆ†ç¦»

## æŠ€æœ¯æ ˆ

å‰ç½®çŸ¥è¯†ï¼šSpring Boot,Spring Security,MySQL,MyBatis,Redis

è¿›é˜¶çŸ¥è¯†ï¼šRabbitMQ,Spring Cache,WebSocket

å‰ç«¯ï¼šVue,ElementUI,Axios,Vue-Router,WebSocket,Vue-Cli4

## ç¯å¢ƒ

è¿™é‡Œæ˜¯åœ¨å•ä¸ªæœºå™¨ä¸Šï¼šWindowsæœ¬åœ°æˆ–è€…ä¸€å°æœåŠ¡å™¨ä¸Šä½“éªŒæ•ˆæœ

- æ‰“å¼€MySQL,åˆ›å»ºç©ºæ•°æ®åº“`vhr`


- æ‰“å¼€Redis


- æ‰“å¼€Nginx


- å®‰è£…rabbitmqï¼Œå…¨éƒ¨éƒ½ç”¨æœ€æ–°ç‰ˆæœ¬

  - [å®‰è£…erlang](https://www.erlang-solutions.com/downloads/) é…ç½®ç¯å¢ƒå˜é‡`cmd> erl -v `å‡ºç°åˆ™æˆåŠŸ

  -  [å®‰è£…RabbitMQ](https://www.rabbitmq.com/download.html) é…ç½®ç¯å¢ƒå˜é‡ `cmd>rabbitmqctl status`å‡ºç°åˆ™æˆåŠŸï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œhttp://localhost:15672

- ä¿è¯æ‰€æœ‰ç¯å¢ƒé…ç½®å¥½ï¼ŒIDEAæ‰“å¼€åç«¯å·¥ç¨‹/vhrï¼ŒWebStormæ‰“å¼€å‰ç«¯å·¥ç¨‹/vuehr


- æ³¨æ„ï¼šä¸è¦å‰åç«¯ç›®å½•ä¸€èµ·æ‰“å¼€ï¼ŒIDEAä¼šè¯†åˆ«ä¸å‡ºspringbooté¡¹ç›®


## ä»£ç 

ç¬¬ä¸€æ­¥ï¼šä¿®æ”¹`application.properties/application.yml`ä¸­çš„MySQL,Redis,RabbitMQé…ç½®

ç¬¬äºŒæ­¥ï¼šå¤§ä½“æµè§ˆä»£ç ï¼Œå¯è§ä»£ç éå¸¸å·¥æ•´ï¼Œæ˜¯åˆ†å¸ƒå¼åˆ†æ¨¡å—å¼€å‘

ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨mailserveræ¨¡å—ï¼Œç„¶åå¯åŠ¨webserveræ¨¡å—

[ä½œè€…å¯¹äºè¿™ä¸ªé¡¹ç›®çš„æ€»ç»“ä¸å±•æœ›](https://mp.weixin.qq.com/s/Eo2RRB6zKQuPDMWlnCHDrw)

æˆ‘å¯¹äºè¿™ä¸ªé¡¹ç›®çš„æ€åº¦ï¼š

ä»£ç æ¸…æ¥šï¼Œæ˜“äºé›†æˆï¼Œé€‚åˆæŠ€æœ¯ç‚¹çš„å­¦ä¹ ï¼Œå¯ä»¥èåˆå…¶ä»–çš„api

## éƒ¨ç½²

### ç”¨Dockeréƒ¨ç½²

ç”¨dockeréƒ¨ç½²ï¼Œè¿™æ ·èƒ½ä¾¿æ·ä¸€äº›ï¼Œçœå»å¾ˆå¤šä¸å¿…è¦çš„éº»çƒ¦

ä¸ä¼šä½¿ç”¨Dockerå‘½ä»¤çš„åŒå­¦å¯ä»¥ç”¨Kitematicå®¢æˆ·ç«¯æˆ–è€…Rancherå®¢æˆ·ç«¯æ¥ç®¡ç†å®¹å™¨

å…­ä¸ªæœåŠ¡ï¼šå‰ç«¯ï¼Œmailserverï¼Œvhr-webï¼ŒMySQLï¼ŒRedisï¼ŒRabbitMQ

- å‰ç«¯ï¼švuehr-8180

- åç«¯ï¼šmailserver-8181
- åç«¯ï¼šwebserver-8182

- æ•°æ®åº“ï¼šMySQL-3306 33060
- ç¼“å­˜ï¼šRedis-6379
- æ¶ˆæ¯é˜Ÿåˆ—ï¼šRabbitMQ-5672 15672 25672 1883 61613

### éƒ¨ç½²äº‹é¡¹

- æœåŠ¡å™¨è¦æ‰“å¼€æ‰€æœ‰çš„æœåŠ¡ç«¯å£

- å› ä¸ºéƒ½æ˜¯å®¹å™¨å†…éƒ¨çš„ï¼Œæ‰€ä»¥è¦å¤–ç½‘IP+å¤–éƒ¨ç«¯å£å·

- å®‰è£…MySQL

  ```bash
  docker run --name sql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=2084team -dit --network host mysql:latest --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
  ```

  æ•°æ®åº“å»ºç©ºåº“`vhr`å³å¯ï¼Œæ³¨æ„æ•°æ®åº“å¯ä»¥æœ¬åœ°æŒ‚è½½æ•°æ®

  é€šè¿‡ä¸€ç§MySQLå®¢æˆ·ç«¯è¿æ¥mysqlï¼Œç›´æ¥ä½¿ç”¨IDEAè‡ªå¸¦çš„æ’ä»¶å°±å¯ä»¥ï¼Œæ³¨æ„è°ƒæ•´æ—¶åŒº`Asia/Shanghai`ï¼Œè¿æ¥é€šç•…æ‰èƒ½åœ¨ä»£ç ä¸­è¿æ¥

- å®‰è£…RabbitMQï¼Œrabbitmqå®¢æˆ·ç«¯ï¼šDockeræ–¹å¼

  ```bash
  docker run -dit --hostname vhr-rabbitmq --name vhr-rabbitmq -e RABBITMQ_DEFAULT_USER=2084team -e RABBITMQ_DEFAULT_PASS=2084team -p 5672:5672 -p 15672:15672 -p 25672:25672 -p 1883:1883 -p 61613:61613 --network host rabbitmq:3-management
  ```

  é€šè¿‡webè®¿é—®å®¢æˆ·ç«¯ï¼ˆip:15672ï¼‰ï¼Œè¿æ¥é€šç•…æ‰èƒ½åœ¨ä»£ç ä¸­è¿æ¥ï¼Œå¦åˆ™è°ƒè¯•

- å®‰è£…Redisï¼šDockeræ–¹å¼

  ```bash
  docker run --name vhr-redis -dit -p 6379:6379 --network host redis
  ```

  é€šè¿‡ä¸€ç§Rediså®¢æˆ·ç«¯è¿æ¥Redisï¼Œ[æ¨èä½¿ç”¨è¿™ä¸ª](https://github.com/qishibo/AnotherRedisDesktopManager)ï¼Œè¿æ¥é€šç•…æ‰èƒ½åœ¨ä»£ç ä¸­è¿æ¥

### åç«¯æœåŠ¡

**æœ¬åœ°æ„å»ºåŒ…ï¼Œå°†é•œåƒæ¨é€åˆ°è¿œç¨‹çš„æœåŠ¡å™¨**

#### IDEAè¿æ¥Linuxä¸»æœºçš„Docker

- [IDEAè¿œç¨‹è¿æ¥Docker](https://mp.weixin.qq.com/s?__biz=MzI1NDY0MTkzNQ==&mid=2247486342&idx=1&sn=b8adcef8237f3d222816c985ff58b654&scene=21#wechat_redirect)ï¼Œæ¨é€é•œåƒï¼Œç”¨æ­¤æ–¹å¼æ¥æ¨é€åç«¯æœåŠ¡é•œåƒï¼Œæ¯”è¾ƒä¾¿æ·

  ```bash
  vim /usr/lib/systemd/system/docker.service
  ```

  ä¿®æ”¹é…ç½®

  - åŸé…ç½®ï¼š -H fd:// --containerd=/run/containerd/containerd.sock

  - ç°é…ç½®ï¼š -H tcp://0.0.0.0:2375  -H unix:///var/run/docker.sock

  é…ç½®æ–‡ä»¶ä¿®æ”¹å¥½ï¼Œä¿è¯åç«¯ä¸€å®šå¯ä»¥è¿æ¥ä¸ŠMySQLï¼ŒRedisï¼ŒRabbitMQï¼Œå°±åƒæˆ‘åˆšæ‰è¯´çš„ï¼Œå®¢æˆ·ç«¯æˆ–è€…webç«¯è¿æ¥æˆåŠŸæ‰èƒ½åœ¨ä»£ç ä¸­è¿æ¥ï¼Œå¦åˆ™åˆ«è¯´é¡¹ç›®è·‘ä¸èµ·æ¥ï¼Œæ‰“åŒ…éƒ½ä¸ä¸€å®šæˆåŠŸï¼

- ç¼–å†™Dockfileæ–‡ä»¶ï¼Œæ”¾åœ¨èƒ½æ‰“åŒ…æˆä¸ºjaråŒ…çš„ä½ç½®ï¼Œæœ¬é¡¹ç›®æ”¾ç½®åœ¨`mailserver`å’Œ`vhr-web`å„ä¸€ä¸ª

#### æ‰“åŒ…æ–¹æ³•

  **åŒ–é‡ç‚¹ï¼Œæœ¬äººè¸©äº†å¾ˆå¤šå‘ï¼Œåœ¨æŸä¸ªè®ºå›ä¸Šå‘ç°æŸå¤§ä½¬çš„ç»éªŒ**

>æ³¨æ„ï¼šå¤šæ¨¡å—é¡¹ç›®ä»…ä»…éœ€è¦åœ¨å¯åŠ¨ç±»æ‰€åœ¨çš„æ¨¡å—æ·»åŠ æ‰“åŒ…æ’ä»¶å³å¯ï¼Œä¸è¦åœ¨çˆ¶ç±»æ·»åŠ æ‰“åŒ…æ’ä»¶ï¼Œå› ä¸ºé‚£æ ·ä¼šå¯¼è‡´å…¨éƒ¨å­æ¨¡å—éƒ½ä½¿ç”¨spring-boot-maven-pluginçš„æ–¹å¼æ¥æ‰“åŒ…ï¼ˆä¾‹å¦‚BOOT-INF/com/hehe/xxï¼‰ï¼Œè€Œmm-webæ¨¡å—å¼•å…¥mm-xx çš„jar éœ€è¦çš„æ˜¯è£¸éœ²çš„ç±»æ–‡ä»¶ï¼Œå³ç›®å½•æ ¼å¼ä¸ºï¼ˆ/com/hehe/xxï¼‰ã€‚

-   Dockerä¹Ÿæ˜¯åº”è¯¥å¦‚æ­¤ï¼Œé¦–å…ˆï¼šä¸åº”è¯¥æœ‰ä¸¤ä¸ªç«¯å£å‡ºç°åœ¨åŒä¸€ä¸ªjaråŒ…å†…ï¼Œç¬¬äºŒï¼špomçš„æ‰“åŒ…æ–¹å¼ä¸èƒ½è·å¾—æˆ‘ä»¬è¦çš„ç¨‹åºï¼Œçˆ¶å·¥ç¨‹åªæ˜¯åˆ†æ¨¡å—å¼€å‘è€Œå·²ï¼Œæˆ‘ä»¬æœ€åè¦çš„æ˜¯jaråŒ…->äº¤ä»˜çš„æ˜¯Linuxå†…çš„Dockeré•œåƒ

- å¯¹äºæœ¬é¡¹ç›®ï¼Œmailserverå’Œvhrserveræ˜¯ä¸¤ä¸ªä¸åŒçš„é¡¹ç›®ï¼Œåªæ˜¯ç”¨RabbitMQé€šä¿¡è€Œå·²ï¼Œpom.xmlä¸­çš„å±‚çº§å…³ç³»è¦ç†æ¸…

- å›é¡¾mavenåŸºç¡€ï¼šmavenä¸­å”¯ä¸€ç¡®å®šä¸€ä¸ªåŒ…çš„ä¸‰ä¸ªå› ç´ æ˜¯ï¼š

```xml
  <dependency>
      <groupId></groupId>
      <artifactId></artifactId>
      <version></version>
  </dependency>
```

- æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æœ‰jaråŒ…çš„ä½ç½®æ”¾ç½®æˆ‘ä»¬çš„dockeræ‰“åŒ…æ’ä»¶ï¼Œæœ€åæ‰“åŒ…æ—¶ï¼Œç›´æ¥æ‰“åŒ…æ•´ä¸ªåç«¯å·¥ç¨‹/vhrå³å¯ï¼Œå› ä¸ºæ¨¡å—æœ‰ä¾èµ–å…³ç³»ï¼Œæˆ‘ä»¬ä¸å¿…å…³å¿ƒå…ˆæ‰“åŒ…å“ªä¸€ä¸ªï¼Œæ‰“åŒ…ä»¥åŠæ„å»ºé•œåƒéœ€è¦5minå¤šï¼Œè€å¿ƒç­‰å¾…ï¼Œæ‰“åŒ…å®Œæˆä¹‹åå¯çœ‹åˆ°è¿œç¨‹æœåŠ¡å™¨å¤šäº†é•œåƒ

-  æœ¬åœ°é‡å¯ideaå¯ä»¥çœ‹åˆ°å³ä¸‹è§’å¤šäº†ä¸ªæç¤ºï¼Œæç¤ºæˆ‘ä»¬å¯ä»¥å‘å¸ƒå®¹å™¨ï¼Œæˆ‘ä»¬è¿æ¥è¿œç¨‹æœåŠ¡å™¨ï¼Œå‘å¸ƒæˆ‘ä»¬çš„å®¹å™¨ï¼ŒCreate Docker Configurationï¼Œæ‹¼å‡‘æˆ‘ä»¬çš„å‘½ä»¤å°†å®¹å™¨è¿è¡Œèµ·æ¥

    å…³äºideaçš„dockerå›¾æ ‡åœ¨å“ªé‡Œæ‰¾ï¼šåœ¨Run/Debug Configurationsé‡Œé¢ï¼Œå°±æ˜¯MVCé˜¶æ®µæˆ‘ä»¬é…ç½®tomcatçš„åœ°æ–¹

- jdkç‰ˆæœ¬è¦å¯¹åº” éƒ½ç”¨11ï¼Œdockeråœ¨æ„å»ºé•œåƒæ—¶çš„jdkç‰ˆæœ¬ä¹Ÿè¦å¯¹åº”ï¼Œå¦åˆ™é¡¹ç›®å¯åŠ¨å¤±è´¥ï¼Œæˆ‘é‡æ„äº†3æ¬¡ï¼Œæ¨èé•œåƒæ„å»ºç”¨`adoptopenjdk/openjdk11:latest`

- æœ€åï¼Œè¿è¡Œå®¹å™¨å³å¯

  ```bash
  docker run -dit -p 8182:8182 --name vhr-web --network host 2084team/vhr-web
  ```

- å…¬ç½‘è®¿é—®

- è¿™äº›æ‰€æœ‰çš„ç»†èŠ‚ï¼Œé”™ä¸€ç‚¹ä½ çš„é¡¹ç›®éƒ½ä¸èƒ½æˆåŠŸï¼

### å‰ç«¯æœåŠ¡

- å¯ä»¥ç”¨dockeræ„å»ºå‰ç«¯å·¥ç¨‹æˆ–å¯ä»¥ç”¨ç¬¬ä¸‰æ–¹å¹³å°æ¥æ”¾ç½®å‰ç«¯æœåŠ¡ï¼Œå‡å°‘æœåŠ¡å™¨å‹åŠ›


- è¿™é‡Œnginxé…ç½®è½¬å‘ç­–ç•¥ï¼Œæ‰€ä»¥ç”¨ç›´æ¥ä¸»æœºï¼Œè€Œä¸æ˜¯å®¹å™¨å†…

  [è¿œç¨‹æœåŠ¡å™¨é…ç½®å‰ç«¯å·¥ç¨‹](https://mp.weixin.qq.com/s/C7PIck3SIPPTcA3NX3ELoQ)

- æœ¬åœ°æ„å»ºå‰ç«¯å·¥ç¨‹ï¼Œé™æ€èµ„æºç›´æ¥æ”¾åˆ°æœåŠ¡å™¨å³å¯

  ```bash
  npm run build 
  ```

- å› ä¸ºnginxåšå†…ç½‘è½¬å‘ï¼Œæ‰€ä»¥åç«¯ä¸ç”¨åšhttpsè¯ä¹¦é…ç½®


- æœåŠ¡å™¨å¤ªå°å¯¼è‡´å¡é¡¿ï¼Œè¿™é‡Œå¯ä»¥é€‰æ‹©ç¬¬ä¸‰æ–¹å¹³å°æ”¾ç½®æœåŠ¡æˆ–è€…å¤§çš„æœåŠ¡å™¨

- Docker æ‰“åŒ…éƒ¨ç½²å‰ç«¯å·¥ç¨‹ï¼Œå¦‚æœæ˜¯è¿™æ ·é‚£ä¹ˆéœ€è¦åœæ­¢æ‰ä¸»æœºä¸Šçš„åŸæ¥çš„nginx `systemctl stop nginx `

  WebStormè¿æ¥os1æœºå™¨çš„Docker

  ç¼–å†™Dockerfileæ–‡ä»¶æš´éœ²ç«¯å£80ï¼Œæ³¨æ„vue.config.jsé…ç½®ä¸­çš„ç«¯å£ä¹Ÿè¦æš´éœ²è¿™ä¸ªç«¯å£ï¼Œå› ä¸ºå‰ç«¯é•œåƒåŸºäºnginx,nginxç›‘å¬ä¸å…è®¸å…¶ä»–ç«¯å£å¦åˆ™è¿è¡Œä¸äº†ï¼Œ`default.conf`ä¸­è½¬å‘çš„è·¯å¾„è¦å†™çœŸå®ipå’ŒçœŸå®ç«¯å£å·ï¼Œå½“ç„¶äº†ï¼Œå¯ä»¥éƒ¨ç½²3ä¸ªåç«¯ï¼Œç„¶åè¿›è¡Œåˆ†æƒé‡è½¬å‘

  ç‚¹å‡»Edit Configurationå¼€å§‹å†™é…ç½®æ‰“åŒ…ï¼Œç¼–è¯‘å¹¶ä¸Šä¼ é•œåƒ

  å¯åŠ¨

  ```bash
  docker run -dit  --name vuehr --network host  vuehr
  ```

### åˆ†æœºå™¨éƒ¨ç½²ç­–ç•¥

æœ€åè™½ç„¶éƒ¨ç½²æˆåŠŸï¼Œä½†æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ•°æ®åº“ï¼Œåç«¯æœåŠ¡ï¼Œå‰ç«¯æœåŠ¡ï¼Œç¼“å­˜æœåŠ¡éƒ½åœ¨ä¸€å°ä¸»æœºä¸Šï¼Œæœ¬äººçš„1æ ¸2Gçš„é˜¿é‡Œäº‘å­¦ç”Ÿæœºå¤ªå°ï¼Œå¯¼è‡´ç¬é—´å¡é¡¿ï¼Œè‡ªå·±çš„åšå®¢éƒ½æŒ‚äº†ï¼Œæ‰€ä»¥ä¸å¾—ä¸ä½¿ç”¨åˆ«çš„æ–¹æ³•ï¼Œå› ä¸ºæˆ‘ä»¬å®éªŒå®¤æœ‰æœºå™¨ï¼Œè¿™ç§åˆ†é…ç­–ç•¥é€‚åˆä¸‰å°æœºå™¨é…ç½®ä¸€æ ·çš„æƒ…å†µ

æˆ‘ä»¬å®éªŒå®¤æœ‰ä¸‰å°æœºå™¨ï¼Œäº’ç›¸æ¥è®²éƒ½æ˜¯å†…ç½‘ï¼Œå¯ä»¥è€ƒè™‘åˆ†é…ç­–ç•¥

æœåŠ¡å™¨å¯†ç å¿˜äº†ï¼Œå¯ä»¥ä¸Šç½‘æœç´¢ï¼ˆWinSCPå¯†ç å¿˜äº†æ€ä¹ˆåŠï¼‰ï¼Œåˆ«é—®æˆ‘ä¸ºä»€ä¹ˆæœç´¢ğŸ˜‚

| æœåŠ¡\å¹³å° | ç¬¬ä¸‰æ–¹å¹³å°æ‰˜ç®¡ | os1                                 | c1                                 | web1              |
| --------- | -------------- | ----------------------------------- | ---------------------------------- | ----------------- |
| å‰ç«¯æœåŠ¡  | æš‚ä¸è€ƒè™‘       | é™æ€ç›´æ¥æ”¾åœ¨æœ¬åœ°80ç«¯å£æˆ–è€…Docker 80 |                                    |                   |
| åç«¯æœåŠ¡  |                | Docker 8181 8182                    |                                    |                   |
| æ¶ˆæ¯é˜Ÿåˆ—  |                |                                     | Docker 5672 15672 25672 1883 61613 |                   |
| ç¼“å­˜      |                |                                     | Docker 6379                        |                   |
| æ•°æ®åº“    |                |                                     |                                    | Docker 3306 33060 |

æ³¨æ„æˆ‘åˆšæ‰å†™çš„**ç”¨Dockeréƒ¨ç½²***çš„å‘½ä»¤ï¼Œéƒ½åŠ äº†`--network host`ï¼Œå°±æ˜¯ä½¿ç”¨å’Œæœ¬æœºä¸€æ ·çš„ç«¯å£ï¼Œè€Œä¸åˆ›å»ºè™šæ‹Ÿç«¯å£ï¼Œè¿™æ ·åšæ˜¯ä¸è®©dockeråˆ›å»ºæ–°çš„ç½‘å¡ï¼Œåé¢æœ‰è¯´ä¸ºä»€ä¹ˆè¿™æ ·åš

#### ä¸‰å°æœåŠ¡å™¨å®‰è£…é…ç½®Docker

å®‰è£…çœ‹å®˜æ–¹æ–‡æ¡£

é…ç½®dockerçš„å›½å†…é•œåƒ

```bash
# è¿›å…¥æ–‡ä»¶
vim /etc/docker/daemon.json

# ä¿®æ”¹é•œåƒæº
{"registry-mirrors": ["https://registry.cn-hangzhou.aliyuncs.com"]}

# é‡å¯docker
systemctl daemon-reload
systemctl restart docker

# æŸ¥çœ‹é•œåƒæº
docker info|grep Mirrors -A 1
```

#### æœåŠ¡å™¨é…ç½®

æŸ¥çœ‹æœåŠ¡å™¨å†…å­˜ï¼Œå¯çœ‹åˆ°æœåŠ¡å™¨å†…å­˜ç›¸å½“å¤§

```bash
# ubuntu
watch free -h
# centos
free -m 
```

##### æ‰“å¼€centosç«¯å£

```bash
# æŸ¥è¯¢ç«¯å£æ˜¯å¦æ‰“å¼€
firewall-cmd --query-port=[port]/tcp

# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ 
systemctl status firewalld
# å¼€å¯é˜²ç«å¢™ 
systemctl start firewalld  
# å…³é—­é˜²ç«å¢™ 
systemctl stop firewalld
# å¼€å¯é˜²ç«å¢™ 
service firewalld start 
# è‹¥é‡åˆ°æ— æ³•å¼€å¯
# å…ˆç”¨ï¼š
systemctl unmask firewalld.service 
# ç„¶åï¼š
systemctl start firewalld.service

# æ·»åŠ æŒ‡å®šéœ€è¦å¼€æ”¾çš„ç«¯å£ï¼š
firewall-cmd --add-port=123/tcp --permanent
# é‡è½½å…¥æ·»åŠ çš„ç«¯å£ï¼š
firewall-cmd --reload
# æŸ¥è¯¢æŒ‡å®šç«¯å£æ˜¯å¦å¼€å¯æˆåŠŸï¼š
firewall-cmd --query-port=123/tcp
# ç§»é™¤æŒ‡å®šç«¯å£ï¼š
firewall-cmd --permanent --remove-port=123/tcp

# å®‰è£…iptables-services ï¼š
yum install iptables-services 
# è¿›å…¥ä¸‹é¢ç›®å½•è¿›è¡Œä¿®æ”¹ï¼š
/etc/sysconfig/iptables
```

##### æ‰“å¼€ubuntuç«¯å£

```bash
sudo apt-get install iptables
sudo apt-get install iptables-persistent
```

##### é”æ·ä¸Šç½‘

æäº†åŠå¤©ï¼Œå‘ç°æœåŠ¡å™¨ä¸Šç½‘æ–­æ–­ç»­ç»­ï¼ŒæŸ¥çœ‹æ—¥å¿—å‘ç°å¤šç½‘å¡é…ç½®ï¼Œé”æ·ä¼šç¦ç”¨å¤šç½‘å¡ä¸Šç½‘ï¼Œæ‰€ä»¥æ‰ä¼šå‡ºç°åªèƒ½ä¸Šç½‘ä¸€åˆ†é’Ÿç„¶åé€€å‡ºçš„é—®é¢˜ï¼ŒWindowsä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæœ€ç»ˆä¸€å°æœºå™¨ä¸Šå…è®¸å­˜åœ¨ï¼šdocker0ï¼Œens*ï¼Œloä¸‰ä¸ªç½‘å¡ï¼Œä¸èƒ½å‡ºç°å…¶ä»–çš„ç½‘å¡

```bash
ifconfig 
sudo ifconfig [ç½‘å¡] down
```

ä¸Šç½‘äº†ï¼Œä½†æ˜¯åˆ é™¤ç½‘å¡å¯¼è‡´äº†å®¹å™¨ç½‘ç»œæ¶ˆå¤±ï¼Œæˆ‘å°†ç½‘å¡åœæ‰ï¼Œå‘ç°web1å’Œc1ä¸¤å°æœºå™¨ï¼ˆMySQLï¼ŒRediså’ŒRabbitMQï¼‰å®¢æˆ·ç«¯éƒ½è¿ä¸ä¸Šäº†

è¿™æ˜¯å› ä¸ºé”æ·è®¤è¯ä¸Šç½‘ï¼Œé™¤äº†æœ¬åœ°çš„ç½‘å¡ä¸èƒ½æœ‰å…¶ä»–è™šæ‹Ÿç½‘å¡ï¼Œä½†æ˜¯Dockeråœ¨è¿è¡Œå®¹å™¨æ—¶ä¼šåˆ›å»ºæ–°çš„ç½‘å¡ï¼ˆdocker0æœ¬èº«æ²¡äº‹ï¼‰ï¼Œæ‰€ä»¥dockerå’Œruijieä¸Šç½‘å†²çªï¼Œä¸å¾—ä¸é€‰æ‹©`--netowrk host`çš„å®¹å™¨å¯åŠ¨æ–¹å¼

è¿™é‡Œè¦è¯´ï¼šé”æ·ä¸Šç½‘å’ŒDockerå®¹å™¨å¹¶å­˜çš„è§£å†³æ–¹æ¡ˆæ˜¯æˆ‘æ‘¸ç´¢å‡ºæ¥çš„ï¼ˆå¹¸äºå­¦äº†Dockerç½‘ç»œåŸç†ï¼‰ï¼Œå…³äºDockerå¯ä»¥ä¸ŠBç«™æ‰¾[ç‹‚ç¥è¯´](https://www.bilibili.com/video/BV1og4y1q7M4)

[åŸæ–‡é“¾æ¥](https://www.jianshu.com/p/22a7032bb7bd)

>hostæ¨¡å¼
>å¦‚æœå¯åŠ¨å®¹å™¨çš„æ—¶å€™ä½¿ç”¨hostæ¨¡å¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¹å™¨å°†ä¸ä¼šè·å¾—ä¸€ä¸ªç‹¬ç«‹çš„Network Namespaceï¼Œè€Œæ˜¯å’Œå®¿ä¸»æœºå…±ç”¨ä¸€ä¸ªNetwork Namespaceã€‚å®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„IPç­‰ï¼Œè€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„IPå’Œç«¯å£ã€‚ä½†æ˜¯ï¼Œå®¹å™¨çš„å…¶ä»–æ–¹é¢ï¼Œå¦‚æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ç­‰è¿˜æ˜¯å’Œå®¿ä¸»æœºéš”ç¦»çš„ã€‚
>
>ä½¿ç”¨hostæ¨¡å¼çš„å®¹å™¨å¯ä»¥ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„IPåœ°å€ä¸å¤–ç•Œé€šä¿¡ï¼Œå®¹å™¨å†…éƒ¨çš„æœåŠ¡ç«¯å£ä¹Ÿå¯ä»¥ä½¿ç”¨å®¿ä¸»æœºçš„ç«¯å£ï¼Œä¸éœ€è¦è¿›è¡ŒNATï¼Œhostæœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯ç½‘ç»œæ€§èƒ½æ¯”è¾ƒå¥½ï¼Œä½†æ˜¯docker hostä¸Šå·²ç»ä½¿ç”¨çš„ç«¯å£å°±ä¸èƒ½å†ç”¨äº†ï¼Œç½‘ç»œçš„éš”ç¦»æ€§ä¸å¥½ã€‚

è¿™æ ·æ—¢èƒ½ä¿è¯ç½‘ç»œé€šç•…ï¼Œåˆèƒ½ä¿è¯dockerå®¹å™¨æœåŠ¡ï¼Œä¹Ÿå°±æ˜¯è¯´-pæ²¡æœ‰ç”¨äº†ï¼Œä½ åœ¨è¿è¡ŒMySQL,Redis,RabbitMQå’Œä¸¤ä¸ªåç«¯æœåŠ¡æ—¶åŠ ä¸åŠ -péƒ½æ²¡äº‹ï¼Œç›´æ¥ä½¿ç”¨ä¸»æœºç«¯å£ï¼Œè€Œä¸æ˜¯è™šæ‹Ÿç«¯å£çš„æ˜ å°„

#### os1ä¸»æœºåå‘ä»£ç†,åˆ†å‘è¯·æ±‚

- os1å®‰è£…nginx


```bash
apt-get install nginx 
```

é…ç½®æ–‡ä»¶ä½ç½®ï¼š/etc/nginx/nginx.conf

è¯ä¹¦ä½ç½®ï¼š/home/tls_certificate/*

- æˆ‘ä»¬å°†åŸŸåè¯ä¹¦å’Œå‰ç«¯æ‰“åŒ…å¥½çš„æœåŠ¡ä¸Šä¼ åˆ°æœåŠ¡å™¨

ç”¨scpå°†Windowsæœ¬åœ°çš„æ–‡ä»¶ä¼ ç»™æœåŠ¡å™¨

```bash
# å…³é—­ubuntué˜²ç«å¢™è¦
ufw disable
# å¼€æ”¾ç«¯å£
sudo ufw allow 21
ufw default allow 21
# ä¼ æ–‡ä»¶
scp -P 21 -r /dist/ os1@172.16.75.200:/etc/nginx/sites-available
ufw enable
```

å°†Windowsæœ¬åœ°ç”Ÿæˆçš„å…¬é’¥ç²˜è´´è‡³/root/.sshä¸‹çš„authorized_keyså³å¯ï¼Œå¦åˆ™æç¤ºå¯†ç è¾“å…¥é”™è¯¯

[è¿™ç¯‡æ–‡ç« è®²è¿°äº†ä¸¤ä¸ªä¸»æœºå»ºç«‹ä¿¡ä»»çš„è¿‡ç¨‹](https://www.pianshen.com/article/2436461320/)

æˆ–è€…ç”¨rootæ”¹æ–‡ä»¶æ“ä½œæƒé™ï¼Œç›´æ¥æ‹–æ‹½æ–‡ä»¶å³å¯

```bash
chmod 777 
```

### å°ç»“

åŸŸåè¦è§£æåˆ°os1ä¸»æœºä¸Šï¼Œè¿™æ ·é™æ€èµ„æºï¼ˆ * .html,å­—ä½“å›¾æ ‡ï¼Œ* .js ï¼Œ*.cssï¼‰ç­‰ä¼šç›´æ¥è¯»å–æœåŠ¡å™¨ç£ç›˜ï¼Œnginxä¼šè½¬å‘è¯·æ±‚ç»™åç«¯ï¼Œå¯¹äºä¸‰å°æœºå™¨æ¥è®²éƒ½æ˜¯å†…ç½‘ï¼Œè¿™æ ·å‰åç«¯åˆ†ç¦»ï¼Œæ•°æ®åº“ï¼Œç¼“å­˜ï¼Œæ¶ˆæ¯é˜Ÿåˆ—éƒ½åˆ†å¼€è®¿é—®é€Ÿåº¦è‚¯å®šå¿«ï¼Œå¦‚æœä¸éœ€è¦å¤–ç½‘è®¿é—®ï¼Œé‚£ä¹ˆåˆ°è¿™é‡Œå°±å¯ä»¥äº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸ºäº†å¤–ç½‘è®¿é—®ï¼Œéœ€è¦frpå†…ç½‘ç©¿é€

### å†…ç½‘ç©¿é€

#### ç®€ä»‹

[frpå®˜æ–¹æ–‡æ¡£](https://gofrp.org/docs/)

é‚£ä¹ˆç°åœ¨å·²ç»å¯ä»¥é€šè¿‡å†…ç½‘ï¼ˆæ ¡å›­ç½‘ï¼‰è®¿é—®æˆ‘ä»¬çš„ç³»ç»Ÿ https://oa.2084team.com ï¼Œä½†æ˜¯æƒ³è¦é€šè¿‡å¤–ç½‘è¿˜è¦é…ç½®frpå†…ç½‘ç©¿é€

[Windowsæœ¬åœ°ä¸‹è½½](https://github.com/fatedier/frp/releases/download/v0.36.2/frp_0.36.2_linux_amd64.tar.gz)ï¼Œæ­£å¸¸è§£å‹ä¸Šä¼ æ­¢æœåŠ¡å™¨å³å¯

æ–‡ä»¶ç›®å½•

frpså…¬ç½‘æœåŠ¡å™¨root /home/frps

frpcå†…ç½‘æœåŠ¡å™¨os1 /home/frpc

#### SSH å¤–ç½‘è¿æ¥å†…ç½‘æœåŠ¡å™¨

ç”¨SSHå‘½ä»¤è¡Œæ–¹å¼è¿æ¥å†…ç½‘æœåŠ¡å™¨

- ç¡®ä¿å¯¹åº”ç«¯å£æ‰“å¼€ï¼šå†…ç½‘å¤–ç½‘ç«¯å£éƒ½æ‰“å¼€
- ç¡®ä¿å†…ç½‘æœåŠ¡å™¨èƒ½ä¸Šç½‘ï¼Œè¿æ¥å¤–ç½‘

æŒ‰ç…§æ–‡æ¡£çš„é…ç½®æ–‡ä»¶ç¼–å†™ï¼Œç„¶åæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªä¸è¿æ¥å†…ç½‘çš„æœºå™¨ï¼Œæ¯”å¦‚iPadè¿æ¥å†…ç½‘æœåŠ¡å™¨è¯•è¯•èƒ½å¦æˆåŠŸ

```bash
# è¿æ¥
ssh -oPort=6000 [å†…ç½‘ç”¨æˆ·å]:[å¤–ç½‘ip]
# å¯†ç æ˜¯å†…ç½‘æœåŠ¡å™¨å¯†ç 
```

ç¡®å®æ˜¯æˆåŠŸäº†ï¼Œè¿™é‡Œä¼šçœ‹èµ·æ¥æœ‰äº›å¥‡æ€ªï¼šç”¨çš„æ˜¯å†…ç½‘ç”¨æˆ·åï¼Œå¤–ç½‘ipï¼Œå†…ç½‘æœåŠ¡å™¨å¯†ç ï¼Œè¿™é‡Œåªæ˜¯frpçš„è½¬å‘ä½œç”¨å°†å¤–ç½‘çš„æµé‡é€šè¿‡6000ç«¯å£è½¬å‘åˆ°äº†å†…ç½‘22ç«¯å£ä¸Šï¼Œé€šä¿¡åè®®ä¸ºtcp

#### åŸŸåè®¿é—®å†…ç½‘webæœåŠ¡

è¿™é‡Œæˆ‘ä»¬ä¸ç”¨è¿™ç§æ–¹å¼ï¼Œè€Œæ˜¯ç›´æ¥é‡‡ç”¨httpsçš„æ–¹å¼

é‚£ä¹ˆæˆ‘ä»¬çš„åŸŸåä¹Ÿè¦è§£æåˆ°å¤–ç½‘æœåŠ¡å™¨ä¸Šäº†

å¤–ç½‘æœå™¨çš„ç«¯å£å¼€æ”¾ä¸€ä¸ªï¼Œç”¨æ¥è®¾ç½®webæœåŠ¡çš„è½¬å‘ç«¯å£ï¼Œéœ€è¦è¯´æ˜ï¼šå¤–ç½‘çš„æœåŠ¡å™¨80å’Œ443ç«¯å£ä¸èƒ½å ç”¨

åŸŸåè¯ä¹¦ï¼š/home/tls_certificate/oa.2084team.com.pem

è¿™éƒ¨åˆ†å¯ä»¥è‡ªå·±æ‘¸ç´¢ï¼Œ[æ²¡å¼„æ˜ç™½å°±çœ‹è¿™ç¯‡æ’­å®¢](https://www.nbmao.com/archives/4452)

å¦‚æœfrpcä¸èƒ½è½¬å‘80æˆ–è€…443ç«¯å£ï¼Œé‚£ä¹ˆå¯ä»¥å°†å‰ç«¯æœåŠ¡æ‰“åŒ…åœ¨Dockerä¸­è¿è¡Œï¼Œç«¯å£ä¸ºé80ç«¯å£

#### å¯åŠ¨æœåŠ¡

é…ç½®æ–‡ä»¶ç¼–å†™å¥½ä»¥å

å…ˆå¯åŠ¨å…¬ç½‘æœåŠ¡å™¨çš„æœåŠ¡ç«¯

```bash
./frps -c ./frps.ini
```

ç„¶åå¯åŠ¨å†…ç½‘æœåŠ¡å™¨çš„å®¢æˆ·ç«¯

```bash
./frpc -c ./frpc.ini
```

é•¿æœŸè¿è¡Œfrpéœ€è¦ç¼–å†™shellè„šæœ¬æ”¾åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„`/etc/systemd/system`ç›®å½•ä¸‹

ç¼–å†™shellè„šæœ¬ï¼Œåå°é•¿æœŸå¯åŠ¨frps,frpc

#### å…¬ç½‘æœåŠ¡ç«¯frps

```shell
vim /etc/systemd/system/frps.service

# shellè„šæœ¬
[Unit]
Description=frp-server daemon
Wants=NetworkManager-wait-online.service network-online.target
After=NetworkManager-wait-online.service network.target network-online.target
#After=network.target
[Service]
Type=simple
#User=root
Restart=on-failure
RestartSec=5s
WorkingDirectory=/home/frps
ExecStart=/home/frps/frps -c /home/frps/frps.ini
[Install]
WantedBy=multi-user.target
```

ç„¶åå°±å¯ä»¥æŒ‡æŒ¥è„šæœ¬äº†

```shell
sudo systemctl daemon-reload
sudo systemctl enable frps.service
sudo systemctl disable frps.service
sudo systemctl start frps.service
sudo systemctl stop frps.service
sudo systemctl restart frps.service
sudo systemctl status frps.service
```

#### å†…ç½‘å®¢æˆ·ç«¯frpc

è¿™ä¸ªç±»ä¼¼äºfrpsçš„

```shell
vim /etc/systemd/system/frpc.service

# shellè„šæœ¬
[Unit]
Description=frp-client daemon
Wants=NetworkManager-wait-online.service network-online.target
After=NetworkManager-wait-online.service network.target network-online.target
#After=network.target
[Service]
Type=simple
#User=root
Restart=on-failure
RestartSec=5s
WorkingDirectory=/home/frpc
ExecStart=/home/frpc/frpc -c /home/frpc/frpc.ini
ExecReload=/home/frpc/frpc reload -c /home/frpc/frpc.ini
[Install]
WantedBy=multi-user.target
```

æŒ‡æŒ¥è„šæœ¬

```shell
sudo systemctl daemon-reload
sudo systemctl enable frpc.service
sudo systemctl disable frpc.service
sudo systemctl start frpc.service
sudo systemctl stop frpc.service
sudo systemctl restart frpc.service
sudo systemctl status frpc.service
```

è‡³æ­¤å·²ç»å¯ä»¥é€šè¿‡å¤–ç½‘è®¿é—®äº†ï¼Œç»“æŸï¼ï¼ï¼
